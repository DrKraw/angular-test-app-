"use strict";
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
/**
 * @fileoverview
 * @suppress {globalThis,undefinedVars}
 */
Zone.__load_patch('Error', function (global, Zone, api) {
    /*
     * This code patches Error so that:
     *   - It ignores un-needed stack frames.
     *   - It Shows the associated Zone for reach frame.
     */
    var blacklistedStackFramesSymbol = api.symbol('blacklistedStackFrames');
    var NativeError = global[api.symbol('Error')] = global['Error'];
    // Store the frames which should be removed from the stack frames
    var blackListedStackFrames = {};
    // We must find the frame where Error was created, otherwise we assume we don't understand stack
    var zoneAwareFrame1;
    var zoneAwareFrame2;
    var zoneAwareFrame1WithoutNew;
    var zoneAwareFrame2WithoutNew;
    var zoneAwareFrame3WithoutNew;
    global['Error'] = ZoneAwareError;
    var stackRewrite = 'stackRewrite';
    var blackListedStackFramesPolicy = global['__Zone_Error_BlacklistedStackFrames_policy'] || 'default';
    function buildZoneFrameNames(zoneFrame) {
        var zoneFrameName = { zoneName: zoneFrame.zone.name };
        var result = zoneFrameName;
        while (zoneFrame.parent) {
            zoneFrame = zoneFrame.parent;
            var parentZoneFrameName = { zoneName: zoneFrame.zone.name };
            zoneFrameName.parent = parentZoneFrameName;
            zoneFrameName = parentZoneFrameName;
        }
        return result;
    }
    function buildZoneAwareStackFrames(originalStack, zoneFrame, isZoneFrame) {
        if (isZoneFrame === void 0) { isZoneFrame = true; }
        var frames = originalStack.split('\n');
        var i = 0;
        // Find the first frame
        while (!(frames[i] === zoneAwareFrame1 || frames[i] === zoneAwareFrame2 ||
            frames[i] === zoneAwareFrame1WithoutNew || frames[i] === zoneAwareFrame2WithoutNew ||
            frames[i] === zoneAwareFrame3WithoutNew) &&
            i < frames.length) {
            i++;
        }
        for (; i < frames.length && zoneFrame; i++) {
            var frame = frames[i];
            if (frame.trim()) {
                switch (blackListedStackFrames[frame]) {
                    case 0 /* blackList */:
                        frames.splice(i, 1);
                        i--;
                        break;
                    case 1 /* transition */:
                        if (zoneFrame.parent) {
                            // This is the special frame where zone changed. Print and process it accordingly
                            zoneFrame = zoneFrame.parent;
                        }
                        else {
                            zoneFrame = null;
                        }
                        frames.splice(i, 1);
                        i--;
                        break;
                    default:
                        frames[i] += isZoneFrame ? " [" + zoneFrame.zone.name + "]" :
                            " [" + zoneFrame.zoneName + "]";
                }
            }
        }
        return frames.join('\n');
    }
    /**
     * This is ZoneAwareError which processes the stack frame and cleans up extra frames as well as
     * adds zone information to it.
     */
    function ZoneAwareError() {
        var _this = this;
        // We always have to return native error otherwise the browser console will not work.
        var error = NativeError.apply(this, arguments);
        // Save original stack trace
        var originalStack = error['originalStack'] = error.stack;
        // Process the stack trace and rewrite the frames.
        if (ZoneAwareError[stackRewrite] && originalStack) {
            var zoneFrame = api.currentZoneFrame();
            if (blackListedStackFramesPolicy === 'lazy') {
                // don't handle stack trace now
                error[api.symbol('zoneFrameNames')] = buildZoneFrameNames(zoneFrame);
            }
            else if (blackListedStackFramesPolicy === 'default') {
                try {
                    error.stack = error.zoneAwareStack = buildZoneAwareStackFrames(originalStack, zoneFrame);
                }
                catch (e) {
                    // ignore as some browsers don't allow overriding of stack
                }
            }
        }
        if (this instanceof NativeError && this.constructor != NativeError) {
            // We got called with a `new` operator AND we are subclass of ZoneAwareError
            // in that case we have to copy all of our properties to `this`.
            Object.keys(error).concat('stack', 'message').forEach(function (key) {
                var value = error[key];
                if (value !== undefined) {
                    try {
                        _this[key] = value;
                    }
                    catch (e) {
                        // ignore the assignment in case it is a setter and it throws.
                    }
                }
            });
            return this;
        }
        return error;
    }
    // Copy the prototype so that instanceof operator works as expected
    ZoneAwareError.prototype = NativeError.prototype;
    ZoneAwareError[blacklistedStackFramesSymbol] = blackListedStackFrames;
    ZoneAwareError[stackRewrite] = false;
    var zoneAwareStackSymbol = api.symbol('zoneAwareStack');
    // try to define zoneAwareStack property when blackListed
    // policy is delay
    if (blackListedStackFramesPolicy === 'lazy') {
        Object.defineProperty(ZoneAwareError.prototype, 'zoneAwareStack', {
            configurable: true,
            enumerable: true,
            get: function () {
                if (!this[zoneAwareStackSymbol]) {
                    this[zoneAwareStackSymbol] = buildZoneAwareStackFrames(this.originalStack, this[api.symbol('zoneFrameNames')], false);
                }
                return this[zoneAwareStackSymbol];
            },
            set: function (newStack) {
                this.originalStack = newStack;
                this[zoneAwareStackSymbol] = buildZoneAwareStackFrames(this.originalStack, this[api.symbol('zoneFrameNames')], false);
            }
        });
    }
    // those properties need special handling
    var specialPropertyNames = ['stackTraceLimit', 'captureStackTrace', 'prepareStackTrace'];
    // those properties of NativeError should be set to ZoneAwareError
    var nativeErrorProperties = Object.keys(NativeError);
    if (nativeErrorProperties) {
        nativeErrorProperties.forEach(function (prop) {
            if (specialPropertyNames.filter(function (sp) { return sp === prop; }).length === 0) {
                Object.defineProperty(ZoneAwareError, prop, {
                    get: function () { return NativeError[prop]; },
                    set: function (value) { NativeError[prop] = value; }
                });
            }
        });
    }
    if (NativeError.hasOwnProperty('stackTraceLimit')) {
        // Extend default stack limit as we will be removing few frames.
        NativeError.stackTraceLimit = Math.max(NativeError.stackTraceLimit, 15);
        // make sure that ZoneAwareError has the same property which forwards to NativeError.
        Object.defineProperty(ZoneAwareError, 'stackTraceLimit', {
            get: function () { return NativeError.stackTraceLimit; },
            set: function (value) { return NativeError.stackTraceLimit = value; }
        });
    }
    if (NativeError.hasOwnProperty('captureStackTrace')) {
        Object.defineProperty(ZoneAwareError, 'captureStackTrace', {
            // add named function here because we need to remove this
            // stack frame when prepareStackTrace below
            value: function zoneCaptureStackTrace(targetObject, constructorOpt) {
                NativeError.captureStackTrace(targetObject, constructorOpt);
            }
        });
    }
    var ZONE_CAPTURESTACKTRACE = 'zoneCaptureStackTrace';
    Object.defineProperty(ZoneAwareError, 'prepareStackTrace', {
        get: function () { return NativeError.prepareStackTrace; },
        set: function (value) {
            if (!value || typeof value !== 'function') {
                return NativeError.prepareStackTrace = value;
            }
            return NativeError.prepareStackTrace = function (error, structuredStackTrace) {
                // remove additional stack information from ZoneAwareError.captureStackTrace
                if (structuredStackTrace) {
                    for (var i = 0; i < structuredStackTrace.length; i++) {
                        var st = structuredStackTrace[i];
                        // remove the first function which name is zoneCaptureStackTrace
                        if (st.getFunctionName() === ZONE_CAPTURESTACKTRACE) {
                            structuredStackTrace.splice(i, 1);
                            break;
                        }
                    }
                }
                return value.call(this, error, structuredStackTrace);
            };
        }
    });
    if (blackListedStackFramesPolicy === 'disable') {
        // don't need to run detectZone to populate
        // blacklisted stack frames
        return;
    }
    // Now we need to populate the `blacklistedStackFrames` as well as find the
    // run/runGuarded/runTask frames. This is done by creating a detect zone and then threading
    // the execution through all of the above methods so that we can look at the stack trace and
    // find the frames of interest.
    var detectZone = Zone.current.fork({
        name: 'detect',
        onHandleError: function (parentZD, current, target, error) {
            if (error.originalStack && Error === ZoneAwareError) {
                var frames_1 = error.originalStack.split(/\n/);
                var runFrame = false, runGuardedFrame = false, runTaskFrame = false;
                while (frames_1.length) {
                    var frame = frames_1.shift();
                    // On safari it is possible to have stack frame with no line number.
                    // This check makes sure that we don't filter frames on name only (must have
                    // line number or exact equals to `ZoneAwareError`)
                    if (/:\d+:\d+/.test(frame) || frame === 'ZoneAwareError') {
                        // Get rid of the path so that we don't accidentally find function name in path.
                        // In chrome the separator is `(` and `@` in FF and safari
                        // Chrome: at Zone.run (zone.js:100)
                        // Chrome: at Zone.run (http://localhost:9876/base/build/lib/zone.js:100:24)
                        // FireFox: Zone.prototype.run@http://localhost:9876/base/build/lib/zone.js:101:24
                        // Safari: run@http://localhost:9876/base/build/lib/zone.js:101:24
                        var fnName = frame.split('(')[0].split('@')[0];
                        var frameType = 1 /* transition */;
                        if (fnName.indexOf('ZoneAwareError') !== -1) {
                            if (fnName.indexOf('new ZoneAwareError') !== -1) {
                                zoneAwareFrame1 = frame;
                                zoneAwareFrame2 = frame.replace('new ZoneAwareError', 'new Error.ZoneAwareError');
                            }
                            else {
                                zoneAwareFrame1WithoutNew = frame;
                                zoneAwareFrame2WithoutNew = frame.replace('Error.', '');
                                if (frame.indexOf('Error.ZoneAwareError') === -1) {
                                    zoneAwareFrame3WithoutNew =
                                        frame.replace('ZoneAwareError', 'Error.ZoneAwareError');
                                }
                            }
                            blackListedStackFrames[zoneAwareFrame2] = 0 /* blackList */;
                        }
                        if (fnName.indexOf('runGuarded') !== -1) {
                            runGuardedFrame = true;
                        }
                        else if (fnName.indexOf('runTask') !== -1) {
                            runTaskFrame = true;
                        }
                        else if (fnName.indexOf('run') !== -1) {
                            runFrame = true;
                        }
                        else {
                            frameType = 0 /* blackList */;
                        }
                        blackListedStackFrames[frame] = frameType;
                        // Once we find all of the frames we can stop looking.
                        if (runFrame && runGuardedFrame && runTaskFrame) {
                            ZoneAwareError[stackRewrite] = true;
                            break;
                        }
                    }
                }
            }
            return false;
        }
    });
    // carefully constructor a stack frame which contains all of the frames of interest which
    // need to be detected and blacklisted.
    var childDetectZone = detectZone.fork({
        name: 'child',
        onScheduleTask: function (delegate, curr, target, task) {
            return delegate.scheduleTask(target, task);
        },
        onInvokeTask: function (delegate, curr, target, task, applyThis, applyArgs) {
            return delegate.invokeTask(target, task, applyThis, applyArgs);
        },
        onCancelTask: function (delegate, curr, target, task) {
            return delegate.cancelTask(target, task);
        },
        onInvoke: function (delegate, curr, target, callback, applyThis, applyArgs, source) {
            return delegate.invoke(target, callback, applyThis, applyArgs, source);
        }
    });
    // we need to detect all zone related frames, it will
    // exceed default stackTraceLimit, so we set it to
    // larger number here, and restore it after detect finish.
    var originalStackTraceLimit = Error.stackTraceLimit;
    Error.stackTraceLimit = 100;
    // we schedule event/micro/macro task, and invoke them
    // when onSchedule, so we can get all stack traces for
    // all kinds of tasks with one error thrown.
    childDetectZone.run(function () {
        childDetectZone.runGuarded(function () {
            var fakeTransitionTo = function () { };
            childDetectZone.scheduleEventTask(blacklistedStackFramesSymbol, function () {
                childDetectZone.scheduleMacroTask(blacklistedStackFramesSymbol, function () {
                    childDetectZone.scheduleMicroTask(blacklistedStackFramesSymbol, function () { throw new Error(); }, undefined, function (t) {
                        t._transitionTo = fakeTransitionTo;
                        t.invoke();
                    });
                    childDetectZone.scheduleMicroTask(blacklistedStackFramesSymbol, function () { throw Error(); }, undefined, function (t) {
                        t._transitionTo = fakeTransitionTo;
                        t.invoke();
                    });
                }, undefined, function (t) {
                    t._transitionTo = fakeTransitionTo;
                    t.invoke();
                }, function () { });
            }, undefined, function (t) {
                t._transitionTo = fakeTransitionTo;
                t.invoke();
            }, function () { });
        });
    });
    Error.stackTraceLimit = originalStackTraceLimit;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3ItcmV3cml0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL3pvbmUuanMvbGliL2NvbW1vbi9lcnJvci1yZXdyaXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7O0dBTUc7QUFDSDs7O0dBR0c7QUFpQkgsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsVUFBQyxNQUFXLEVBQUUsSUFBYyxFQUFFLEdBQWlCO0lBQ3hFOzs7O09BSUc7SUFTSCxJQUFNLDRCQUE0QixHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsd0JBQXdCLENBQUMsQ0FBQztJQUMxRSxJQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNsRSxpRUFBaUU7SUFDakUsSUFBTSxzQkFBc0IsR0FBaUMsRUFBRSxDQUFDO0lBQ2hFLGdHQUFnRztJQUNoRyxJQUFJLGVBQXVCLENBQUM7SUFDNUIsSUFBSSxlQUF1QixDQUFDO0lBQzVCLElBQUkseUJBQWlDLENBQUM7SUFDdEMsSUFBSSx5QkFBaUMsQ0FBQztJQUN0QyxJQUFJLHlCQUFpQyxDQUFDO0lBRXRDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxjQUFjLENBQUM7SUFDakMsSUFBTSxZQUFZLEdBQUcsY0FBYyxDQUFDO0lBR3BDLElBQU0sNEJBQTRCLEdBQzlCLE1BQU0sQ0FBQyw0Q0FBNEMsQ0FBQyxJQUFJLFNBQVMsQ0FBQztJQU90RSxTQUFTLG1CQUFtQixDQUFDLFNBQXFCO1FBQ2hELElBQUksYUFBYSxHQUFrQixFQUFDLFFBQVEsRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBQyxDQUFDO1FBQ25FLElBQUksTUFBTSxHQUFHLGFBQWEsQ0FBQztRQUMzQixPQUFPLFNBQVMsQ0FBQyxNQUFNLEVBQUU7WUFDdkIsU0FB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QWlCLENBQzdCLDRCQUE0QixFQUM1QjtvQkFDRSxlQUFlLENBQUMsaUJBQWlCLENBQzdCLDRCQUE0QixFQUFFLGNBQVEsTUFBTSxJQUFJLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsRUFDckUsVUFBQyxDQUFPO3dCQUNMLENBQVMsQ0FBQyxhQUFhLEdBQUcsZ0JBQWdCLENBQUM7d0JBQzVDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztvQkFDYixDQUFDLENBQUMsQ0FBQztvQkFDUCxlQUFlLENBQUMsaUJBQWlCLENBQzdCLDRCQUE0QixFQUFFLGNBQVEsTUFBTSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxTQUFTLEVBQ2pFLFVBQUMsQ0FBTzt3QkFDTCxDQUFTLENBQUMsYUFBYSxHQUFHLGdCQUFnQixDQUFDO3dCQUM1QyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7b0JBQ2IsQ0FBQyxDQUFDLENBQUM7Z0JBQ1QsQ0FBQyxFQUNELFNBQVMsRUFDVCxVQUFDLENBQUM7b0JBQ0MsQ0FBUyxDQUFDLGFBQWEsR0FBRyxnQkFBZ0IsQ0FBQztvQkFDNUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNiLENBQUMsRUFDRCxjQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ2hCLENBQUMsRUFDRCxTQUFTLEVBQ1QsVUFBQyxDQUFDO2dCQUNDLENBQVMsQ0FBQyxhQUFhLEdBQUcsZ0JBQWdCLENBQUM7Z0JBQzVDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNiLENBQUMsRUFDRCxjQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxLQUFLLENBQUMsZUFBZSxHQUFHLHVCQUF1QixDQUFDO0FBQ2xELENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuLyoqXG4gKiBAZmlsZW92ZXJ2aWV3XG4gKiBAc3VwcHJlc3Mge2dsb2JhbFRoaXMsdW5kZWZpbmVkVmFyc31cbiAqL1xuXG4vKipcbiAqIEV4dGVuZCB0aGUgRXJyb3Igd2l0aCBhZGRpdGlvbmFsIGZpZWxkcyBmb3IgcmV3cml0dGVuIHN0YWNrIGZyYW1lc1xuICovXG5pbnRlcmZhY2UgRXJyb3Ige1xuICAvKipcbiAgICogU3RhY2sgdHJhY2Ugd2hlcmUgZXh0cmEgZnJhbWVzIGhhdmUgYmVlbiByZW1vdmVkIGFuZCB6b25lIG5hbWVzIGFkZGVkLlxuICAgKi9cbiAgem9uZUF3YXJlU3RhY2s/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIE9yaWdpbmFsIHN0YWNrIHRyYWNlIHdpdGggbm8gbW9kaWZpY2F0aW9uc1xuICAgKi9cbiAgb3JpZ2luYWxTdGFjaz86IHN0cmluZztcbn1cblxuWm9uZS5fX2xvYWRfcGF0Y2goJ0Vycm9yJywgKGdsb2JhbDogYW55LCBab25lOiBab25lVHlwZSwgYXBpOiBfWm9uZVByaXZhdGUpID0+IHtcbiAgLypcbiAgICogVGhpcyBjb2RlIHBhdGNoZXMgRXJyb3Igc28gdGhhdDpcbiAgICogICAtIEl0IGlnbm9yZXMgdW4tbmVlZGVkIHN0YWNrIGZyYW1lcy5cbiAgICogICAtIEl0IFNob3dzIHRoZSBhc3NvY2lhdGVkIFpvbmUgZm9yIHJlYWNoIGZyYW1lLlxuICAgKi9cblxuICBjb25zdCBlbnVtIEZyYW1lVHlwZSB7XG4gICAgLy8vIFNraXAgdGhpcyBmcmFtZSB3aGVuIHByaW50aW5nIG91dCBzdGFja1xuICAgIGJsYWNrTGlzdCxcbiAgICAvLy8gVGhpcyBmcmFtZSBtYXJrcyB6b25lIHRyYW5zaXRpb25cbiAgICB0cmFuc2l0aW9uXG4gIH1cblxuICBjb25zdCBibGFja2xpc3RlZFN0YWNrRnJhbWVzU3ltYm9sID0gYXBpLnN5bWJvbCgnYmxhY2tsaXN0ZWRTdGFja0ZyYW1lcycpO1xuICBjb25zdCBOYXRpdmVFcnJvciA9IGdsb2JhbFthcGkuc3ltYm9sKCdFcnJvcicpXSA9IGdsb2JhbFsnRXJyb3InXTtcbiAgLy8gU3RvcmUgdGhlIGZyYW1lcyB3aGljaCBzaG91bGQgYmUgcmVtb3ZlZCBmcm9tIHRoZSBzdGFjayBmcmFtZXNcbiAgY29uc3QgYmxhY2tMaXN0ZWRTdGFja0ZyYW1lczoge1tmcmFtZTogc3RyaW5nXTogRnJhbWVUeXBlfSA9IHt9O1xuICAvLyBXZSBtdXN0IGZpbmQgdGhlIGZyYW1lIHdoZXJlIEVycm9yIHdhcyBjcmVhdGVkLCBvdGhlcndpc2Ugd2UgYXNzdW1lIHdlIGRvbid0IHVuZGVyc3RhbmQgc3RhY2tcbiAgbGV0IHpvbmVBd2FyZUZyYW1lMTogc3RyaW5nO1xuICBsZXQgem9uZUF3YXJlRnJhbWUyOiBzdHJpbmc7XG4gIGxldCB6b25lQXdhcmVGcmFtZTFXaXRob3V0TmV3OiBzdHJpbmc7XG4gIGxldCB6b25lQXdhcmVGcmFtZTJXaXRob3V0TmV3OiBzdHJpbmc7XG4gIGxldCB6b25lQXdhcmVGcmFtZTNXaXRob3V0TmV3OiBzdHJpbmc7XG5cbiAgZ2xvYmFsWydFcnJvciddID0gWm9uZUF3YXJlRXJyb3I7XG4gIGNvbnN0IHN0YWNrUmV3cml0ZSA9ICdzdGFja1Jld3JpdGUnO1xuXG4gIHR5cGUgQmxhY2tMaXN0ZWRTdGFja0ZyYW1lc1BvbGljeSA9ICdkZWZhdWx0JyB8ICdkaXNhYmxlJyB8ICdsYXp5JztcbiAgY29uc3QgYmxhY2tMaXN0ZWRTdGFja0ZyYW1lc1BvbGljeTogQmxhY2tMaXN0ZWRTdGFja0ZyYW1lc1BvbGljeSA9XG4gICAgICBnbG9iYWxbJ19fWm9uZV9FcnJvcl9CbGFja2xpc3RlZFN0YWNrRnJhbWVzX3BvbGljeSddIHx8ICdkZWZhdWx0JztcblxuICBpbnRlcmZhY2UgWm9uZUZyYW1lTmFtZSB7XG4gICAgem9uZU5hbWU6IHN0cmluZztcbiAgICBwYXJlbnQ/OiBab25lRnJhbWVOYW1lO1xuICB9XG5cbiAgZnVuY3Rpb24gYnVpbGRab25lRnJhbWVOYW1lcyh6b25lRnJhbWU6IF9ab25lRnJhbWUpIHtcbiAgICBsZXQgem9uZUZyYW1lTmFtZTogWm9uZUZyYW1lTmFtZSA9IHt6b25lTmFtZTogem9uZUZyYW1lLnpvbmUubmFtZX07XG4gICAgbGV0IHJlc3VsdCA9IHpvbmVGcmFtZU5hbWU7XG4gICAgd2hpbGUgKHpvbmVGcmFtZS5wYXJlbnQpIHtcbiAgICAgIHpvbmVGcmFtZSA9IHpvbmVGcmFtZS5wYXJlbnQ7XG4gICAgICBjb25zdCBwYXJlbnRab25lRnJhbWVOYW1lID0ge3pvbmVOYW1lOiB6b25lRnJhbWUuem9uZS5uYW1lfTtcbiAgICAgIHpvbmVGcmFtZU5hbWUucGFyZW50ID0gcGFyZW50Wm9uZUZyYW1lTmFtZTtcbiAgICAgIHpvbmVGcmFtZU5hbWUgPSBwYXJlbnRab25lRnJhbWVOYW1lO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZnVuY3Rpb24gYnVpbGRab25lQXdhcmVTdGFja0ZyYW1lcyhcbiAgICAgIG9yaWdpbmFsU3RhY2s6IHN0cmluZywgem9uZUZyYW1lOiBfWm9uZUZyYW1lIHwgWm9uZUZyYW1lTmFtZSB8IG51bGwsIGlzWm9uZUZyYW1lID0gdHJ1ZSkge1xuICAgIGxldCBmcmFtZXM6IHN0cmluZ1tdID0gb3JpZ2luYWxTdGFjay5zcGxpdCgnXFxuJyk7XG4gICAgbGV0IGkgPSAwO1xuICAgIC8vIEZpbmQgdGhlIGZpcnN0IGZyYW1lXG4gICAgd2hpbGUgKCEoZnJhbWVzW2ldID09PSB6b25lQXdhcmVGcmFtZTEgfHwgZnJhbWVzW2ldID09PSB6b25lQXdhcmVGcmFtZTIgfHxcbiAgICAgICAgICAgICBmcmFtZXNbaV0gPT09IHpvbmVBd2FyZUZyYW1lMVdpdGhvdXROZXcgfHwgZnJhbWVzW2ldID09PSB6b25lQXdhcmVGcmFtZTJXaXRob3V0TmV3IHx8XG4gICAgICAgICAgICAgZnJhbWVzW2ldID09PSB6b25lQXdhcmVGcmFtZTNXaXRob3V0TmV3KSAmJlxuICAgICAgICAgICBpIDwgZnJhbWVzLmxlbmd0aCkge1xuICAgICAgaSsrO1xuICAgIH1cbiAgICBmb3IgKDsgaSA8IGZyYW1lcy5sZW5ndGggJiYgem9uZUZyYW1lOyBpKyspIHtcbiAgICAgIGxldCBmcmFtZSA9IGZyYW1lc1tpXTtcbiAgICAgIGlmIChmcmFtZS50cmltKCkpIHtcbiAgICAgICAgc3dpdGNoIChibGFja0xpc3RlZFN0YWNrRnJhbWVzW2ZyYW1lXSkge1xuICAgICAgICAgIGNhc2UgRnJhbWVUeXBlLmJsYWNrTGlzdDpcbiAgICAgICAgICAgIGZyYW1lcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICBpLS07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIEZyYW1lVHlwZS50cmFuc2l0aW9uOlxuICAgICAgICAgICAgaWYgKHpvbmVGcmFtZS5wYXJlbnQpIHtcbiAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgc3BlY2lhbCBmcmFtZSB3aGVyZSB6b25lIGNoYW5nZWQuIFByaW50IGFuZCBwcm9jZXNzIGl0IGFjY29yZGluZ2x5XG4gICAgICAgICAgICAgIHpvbmVGcmFtZSA9IHpvbmVGcmFtZS5wYXJlbnQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB6b25lRnJhbWUgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZnJhbWVzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIGktLTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBmcmFtZXNbaV0gKz0gaXNab25lRnJhbWUgPyBgIFskeyh6b25lRnJhbWUgYXMgX1pvbmVGcmFtZSkuem9uZS5uYW1lfV1gIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGAgWyR7KHpvbmVGcmFtZSBhcyBab25lRnJhbWVOYW1lKS56b25lTmFtZX1dYDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZnJhbWVzLmpvaW4oJ1xcbicpO1xuICB9XG4gIC8qKlxuICAgKiBUaGlzIGlzIFpvbmVBd2FyZUVycm9yIHdoaWNoIHByb2Nlc3NlcyB0aGUgc3RhY2sgZnJhbWUgYW5kIGNsZWFucyB1cCBleHRyYSBmcmFtZXMgYXMgd2VsbCBhc1xuICAgKiBhZGRzIHpvbmUgaW5mb3JtYXRpb24gdG8gaXQuXG4gICAqL1xuICBmdW5jdGlvbiBab25lQXdhcmVFcnJvcih0aGlzOiB1bmtub3duIHwgdHlwZW9mIE5hdGl2ZUVycm9yKTogRXJyb3Ige1xuICAgIC8vIFdlIGFsd2F5cyBoYXZlIHRvIHJldHVybiBuYXRpdmUgZXJyb3Igb3RoZXJ3aXNlIHRoZSBicm93c2VyIGNvbnNvbGUgd2lsbCBub3Qgd29yay5cbiAgICBsZXQgZXJyb3I6IEVycm9yID0gTmF0aXZlRXJyb3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAvLyBTYXZlIG9yaWdpbmFsIHN0YWNrIHRyYWNlXG4gICAgY29uc3Qgb3JpZ2luYWxTdGFjayA9IChlcnJvciBhcyBhbnkpWydvcmlnaW5hbFN0YWNrJ10gPSBlcnJvci5zdGFjaztcblxuICAgIC8vIFByb2Nlc3MgdGhlIHN0YWNrIHRyYWNlIGFuZCByZXdyaXRlIHRoZSBmcmFtZXMuXG4gICAgaWYgKChab25lQXdhcmVFcnJvciBhcyBhbnkpW3N0YWNrUmV3cml0ZV0gJiYgb3JpZ2luYWxTdGFjaykge1xuICAgICAgbGV0IHpvbmVGcmFtZSA9IGFwaS5jdXJyZW50Wm9uZUZyYW1lKCk7XG4gICAgICBpZiAoYmxhY2tMaXN0ZWRTdGFja0ZyYW1lc1BvbGljeSA9PT0gJ2xhenknKSB7XG4gICAgICAgIC8vIGRvbid0IGhhbmRsZSBzdGFjayB0cmFjZSBub3dcbiAgICAgICAgKGVycm9yIGFzIGFueSlbYXBpLnN5bWJvbCgnem9uZUZyYW1lTmFtZXMnKV0gPSBidWlsZFpvbmVGcmFtZU5hbWVzKHpvbmVGcmFtZSk7XG4gICAgICB9IGVsc2UgaWYgKGJsYWNrTGlzdGVkU3RhY2tGcmFtZXNQb2xpY3kgPT09ICdkZWZhdWx0Jykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGVycm9yLnN0YWNrID0gZXJyb3Iuem9uZUF3YXJlU3RhY2sgPSBidWlsZFpvbmVBd2FyZVN0YWNrRnJhbWVzKG9yaWdpbmFsU3RhY2ssIHpvbmVGcmFtZSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAvLyBpZ25vcmUgYXMgc29tZSBicm93c2VycyBkb24ndCBhbGxvdyBvdmVycmlkaW5nIG9mIHN0YWNrXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcyBpbnN0YW5jZW9mIE5hdGl2ZUVycm9yICYmIHRoaXMuY29uc3RydWN0b3IgIT0gTmF0aXZlRXJyb3IpIHtcbiAgICAgIC8vIFdlIGdvdCBjYWxsZWQgd2l0aCBhIGBuZXdgIG9wZXJhdG9yIEFORCB3ZSBhcmUgc3ViY2xhc3Mgb2YgWm9uZUF3YXJlRXJyb3JcbiAgICAgIC8vIGluIHRoYXQgY2FzZSB3ZSBoYXZlIHRvIGNvcHkgYWxsIG9mIG91ciBwcm9wZXJ0aWVzIHRvIGB0aGlzYC5cbiAgICAgIE9iamVjdC5rZXlzKGVycm9yKS5jb25jYXQoJ3N0YWNrJywgJ21lc3NhZ2UnKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSAoZXJyb3IgYXMgYW55KVtrZXldO1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBpZ25vcmUgdGhlIGFzc2lnbm1lbnQgaW4gY2FzZSBpdCBpcyBhIHNldHRlciBhbmQgaXQgdGhyb3dzLlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIGVycm9yO1xuICB9XG5cbiAgLy8gQ29weSB0aGUgcHJvdG90eXBlIHNvIHRoYXQgaW5zdGFuY2VvZiBvcGVyYXRvciB3b3JrcyBhcyBleHBlY3RlZFxuICBab25lQXdhcmVFcnJvci5wcm90b3R5cGUgPSBOYXRpdmVFcnJvci5wcm90b3R5cGU7XG4gIChab25lQXdhcmVFcnJvciBhcyBhbnkpW2JsYWNrbGlzdGVkU3RhY2tGcmFtZXNTeW1ib2xdID0gYmxhY2tMaXN0ZWRTdGFja0ZyYW1lcztcbiAgKFpvbmVBd2FyZUVycm9yIGFzIGFueSlbc3RhY2tSZXdyaXRlXSA9IGZhbHNlO1xuXG4gIGNvbnN0IHpvbmVBd2FyZVN0YWNrU3ltYm9sID0gYXBpLnN5bWJvbCgnem9uZUF3YXJlU3RhY2snKTtcblxuICAvLyB0cnkgdG8gZGVmaW5lIHpvbmVBd2FyZVN0YWNrIHByb3BlcnR5IHdoZW4gYmxhY2tMaXN0ZWRcbiAgLy8gcG9saWN5IGlzIGRlbGF5XG4gIGlmIChibGFja0xpc3RlZFN0YWNrRnJhbWVzUG9saWN5ID09PSAnbGF6eScpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoWm9uZUF3YXJlRXJyb3IucHJvdG90eXBlLCAnem9uZUF3YXJlU3RhY2snLCB7XG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzW3pvbmVBd2FyZVN0YWNrU3ltYm9sXSkge1xuICAgICAgICAgIHRoaXNbem9uZUF3YXJlU3RhY2tTeW1ib2xdID0gYnVpbGRab25lQXdhcmVTdGFja0ZyYW1lcyhcbiAgICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFN0YWNrLCB0aGlzW2FwaS5zeW1ib2woJ3pvbmVGcmFtZU5hbWVzJyldLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXNbem9uZUF3YXJlU3RhY2tTeW1ib2xdO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24obmV3U3RhY2s6IHN0cmluZykge1xuICAgICAgICB0aGlzLm9yaWdpbmFsU3RhY2sgPSBuZXdTdGFjaztcbiAgICAgICAgdGhpc1t6b25lQXdhcmVTdGFja1N5bWJvbF0gPSBidWlsZFpvbmVBd2FyZVN0YWNrRnJhbWVzKFxuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbFN0YWNrLCB0aGlzW2FwaS5zeW1ib2woJ3pvbmVGcmFtZU5hbWVzJyldLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyB0aG9zZSBwcm9wZXJ0aWVzIG5lZWQgc3BlY2lhbCBoYW5kbGluZ1xuICBjb25zdCBzcGVjaWFsUHJvcGVydHlOYW1lcyA9IFsnc3RhY2tUcmFjZUxpbWl0JywgJ2NhcHR1cmVTdGFja1RyYWNlJywgJ3ByZXBhcmVTdGFja1RyYWNlJ107XG4gIC8vIHRob3NlIHByb3BlcnRpZXMgb2YgTmF0aXZlRXJyb3Igc2hvdWxkIGJlIHNldCB0byBab25lQXdhcmVFcnJvclxuICBjb25zdCBuYXRpdmVFcnJvclByb3BlcnRpZXMgPSBPYmplY3Qua2V5cyhOYXRpdmVFcnJvcik7XG4gIGlmIChuYXRpdmVFcnJvclByb3BlcnRpZXMpIHtcbiAgICBuYXRpdmVFcnJvclByb3BlcnRpZXMuZm9yRWFjaChwcm9wID0+IHtcbiAgICAgIGlmIChzcGVjaWFsUHJvcGVydHlOYW1lcy5maWx0ZXIoc3AgPT4gc3AgPT09IHByb3ApLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoWm9uZUF3YXJlRXJyb3IsIHByb3AsIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gTmF0aXZlRXJyb3JbcHJvcF07IH0sXG4gICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgeyBOYXRpdmVFcnJvcltwcm9wXSA9IHZhbHVlOyB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKE5hdGl2ZUVycm9yLmhhc093blByb3BlcnR5KCdzdGFja1RyYWNlTGltaXQnKSkge1xuICAgIC8vIEV4dGVuZCBkZWZhdWx0IHN0YWNrIGxpbWl0IGFzIHdlIHdpbGwgYmUgcmVtb3ZpbmcgZmV3IGZyYW1lcy5cbiAgICBOYXRpdmVFcnJvci5zdGFja1RyYWNlTGltaXQgPSBNYXRoLm1heChOYXRpdmVFcnJvci5zdGFja1RyYWNlTGltaXQsIDE1KTtcblxuICAgIC8vIG1ha2Ugc3VyZSB0aGF0IFpvbmVBd2FyZUVycm9yIGhhcyB0aGUgc2FtZSBwcm9wZXJ0eSB3aGljaCBmb3J3YXJkcyB0byBOYXRpdmVFcnJvci5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoWm9uZUF3YXJlRXJyb3IsICdzdGFja1RyYWNlTGltaXQnLCB7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gTmF0aXZlRXJyb3Iuc3RhY2tUcmFjZUxpbWl0OyB9LFxuICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gTmF0aXZlRXJyb3Iuc3RhY2tUcmFjZUxpbWl0ID0gdmFsdWU7IH1cbiAgICB9KTtcbiAgfVxuXG4gIGlmIChOYXRpdmVFcnJvci5oYXNPd25Qcm9wZXJ0eSgnY2FwdHVyZVN0YWNrVHJhY2UnKSkge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShab25lQXdhcmVFcnJvciwgJ2NhcHR1cmVTdGFja1RyYWNlJywge1xuICAgICAgLy8gYWRkIG5hbWVkIGZ1bmN0aW9uIGhlcmUgYmVjYXVzZSB3ZSBuZWVkIHRvIHJlbW92ZSB0aGlzXG4gICAgICAvLyBzdGFjayBmcmFtZSB3aGVuIHByZXBhcmVTdGFja1RyYWNlIGJlbG93XG4gICAgICB2YWx1ZTogZnVuY3Rpb24gem9uZUNhcHR1cmVTdGFja1RyYWNlKHRhcmdldE9iamVjdDogT2JqZWN0LCBjb25zdHJ1Y3Rvck9wdD86IEZ1bmN0aW9uKSB7XG4gICAgICAgIE5hdGl2ZUVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRhcmdldE9iamVjdCwgY29uc3RydWN0b3JPcHQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgWk9ORV9DQVBUVVJFU1RBQ0tUUkFDRSA9ICd6b25lQ2FwdHVyZVN0YWNrVHJhY2UnO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoWm9uZUF3YXJlRXJyb3IsICdwcmVwYXJlU3RhY2tUcmFjZScsIHtcbiAgICBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gTmF0aXZlRXJyb3IucHJlcGFyZVN0YWNrVHJhY2U7IH0sXG4gICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKCF2YWx1ZSB8fCB0eXBlb2YgdmFsdWUgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIE5hdGl2ZUVycm9yLnByZXBhcmVTdGFja1RyYWNlID0gdmFsdWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmF0aXZlRXJyb3IucHJlcGFyZVN0YWNrVHJhY2UgPSBmdW5jdGlvbihcbiAgICAgICAgICAgICAgICAgZXJyb3I6IEVycm9yLCBzdHJ1Y3R1cmVkU3RhY2tUcmFjZToge2dldEZ1bmN0aW9uTmFtZTogRnVuY3Rpb259W10pIHtcbiAgICAgICAgLy8gcmVtb3ZlIGFkZGl0aW9uYWwgc3RhY2sgaW5mb3JtYXRpb24gZnJvbSBab25lQXdhcmVFcnJvci5jYXB0dXJlU3RhY2tUcmFjZVxuICAgICAgICBpZiAoc3RydWN0dXJlZFN0YWNrVHJhY2UpIHtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0cnVjdHVyZWRTdGFja1RyYWNlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBzdCA9IHN0cnVjdHVyZWRTdGFja1RyYWNlW2ldO1xuICAgICAgICAgICAgLy8gcmVtb3ZlIHRoZSBmaXJzdCBmdW5jdGlvbiB3aGljaCBuYW1lIGlzIHpvbmVDYXB0dXJlU3RhY2tUcmFjZVxuICAgICAgICAgICAgaWYgKHN0LmdldEZ1bmN0aW9uTmFtZSgpID09PSBaT05FX0NBUFRVUkVTVEFDS1RSQUNFKSB7XG4gICAgICAgICAgICAgIHN0cnVjdHVyZWRTdGFja1RyYWNlLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZS5jYWxsKHRoaXMsIGVycm9yLCBzdHJ1Y3R1cmVkU3RhY2tUcmFjZSk7XG4gICAgICB9O1xuICAgIH1cbiAgfSk7XG5cbiAgaWYgKGJsYWNrTGlzdGVkU3RhY2tGcmFtZXNQb2xpY3kgPT09ICdkaXNhYmxlJykge1xuICAgIC8vIGRvbid0IG5lZWQgdG8gcnVuIGRldGVjdFpvbmUgdG8gcG9wdWxhdGVcbiAgICAvLyBibGFja2xpc3RlZCBzdGFjayBmcmFtZXNcbiAgICByZXR1cm47XG4gIH1cbiAgLy8gTm93IHdlIG5lZWQgdG8gcG9wdWxhdGUgdGhlIGBibGFja2xpc3RlZFN0YWNrRnJhbWVzYCBhcyB3ZWxsIGFzIGZpbmQgdGhlXG4gIC8vIHJ1bi9ydW5HdWFyZGVkL3J1blRhc2sgZnJhbWVzLiBUaGlzIGlzIGRvbmUgYnkgY3JlYXRpbmcgYSBkZXRlY3Qgem9uZSBhbmQgdGhlbiB0aHJlYWRpbmdcbiAgLy8gdGhlIGV4ZWN1dGlvbiB0aHJvdWdoIGFsbCBvZiB0aGUgYWJvdmUgbWV0aG9kcyBzbyB0aGF0IHdlIGNhbiBsb29rIGF0IHRoZSBzdGFjayB0cmFjZSBhbmRcbiAgLy8gZmluZCB0aGUgZnJhbWVzIG9mIGludGVyZXN0LlxuXG4gIGxldCBkZXRlY3Rab25lOiBab25lID0gWm9uZS5jdXJyZW50LmZvcmsoe1xuICAgIG5hbWU6ICdkZXRlY3QnLFxuICAgIG9uSGFuZGxlRXJyb3I6IGZ1bmN0aW9uKFxuICAgICAgICBwYXJlbnRaRDogWm9uZURlbGVnYXRlLCBjdXJyZW50OiBab25lLCB0YXJnZXQ6IFpvbmUsIGVycm9yOiBhbnkpOiBib29sZWFuIHtcbiAgICAgIGlmIChlcnJvci5vcmlnaW5hbFN0YWNrICYmIEVycm9yID09PSBab25lQXdhcmVFcnJvcikge1xuICAgICAgICBsZXQgZnJhbWVzID0gZXJyb3Iub3JpZ2luYWxTdGFjay5zcGxpdCgvXFxuLyk7XG4gICAgICAgIGxldCBydW5GcmFtZSA9IGZhbHNlLCBydW5HdWFyZGVkRnJhbWUgPSBmYWxzZSwgcnVuVGFza0ZyYW1lID0gZmFsc2U7XG4gICAgICAgIHdoaWxlIChmcmFtZXMubGVuZ3RoKSB7XG4gICAgICAgICAgbGV0IGZyYW1lID0gZnJhbWVzLnNoaWZ0KCk7XG4gICAgICAgICAgLy8gT24gc2FmYXJpIGl0IGlzIHBvc3NpYmxlIHRvIGhhdmUgc3RhY2sgZnJhbWUgd2l0aCBubyBsaW5lIG51bWJlci5cbiAgICAgICAgICAvLyBUaGlzIGNoZWNrIG1ha2VzIHN1cmUgdGhhdCB3ZSBkb24ndCBmaWx0ZXIgZnJhbWVzIG9uIG5hbWUgb25seSAobXVzdCBoYXZlXG4gICAgICAgICAgLy8gbGluZSBudW1iZXIgb3IgZXhhY3QgZXF1YWxzIHRvIGBab25lQXdhcmVFcnJvcmApXG4gICAgICAgICAgaWYgKC86XFxkKzpcXGQrLy50ZXN0KGZyYW1lKSB8fCBmcmFtZSA9PT0gJ1pvbmVBd2FyZUVycm9yJykge1xuICAgICAgICAgICAgLy8gR2V0IHJpZCBvZiB0aGUgcGF0aCBzbyB0aGF0IHdlIGRvbid0IGFjY2lkZW50YWxseSBmaW5kIGZ1bmN0aW9uIG5hbWUgaW4gcGF0aC5cbiAgICAgICAgICAgIC8vIEluIGNocm9tZSB0aGUgc2VwYXJhdG9yIGlzIGAoYCBhbmQgYEBgIGluIEZGIGFuZCBzYWZhcmlcbiAgICAgICAgICAgIC8vIENocm9tZTogYXQgWm9uZS5ydW4gKHpvbmUuanM6MTAwKVxuICAgICAgICAgICAgLy8gQ2hyb21lOiBhdCBab25lLnJ1biAoaHR0cDovL2xvY2FsaG9zdDo5ODc2L2Jhc2UvYnVpbGQvbGliL3pvbmUuanM6MTAwOjI0KVxuICAgICAgICAgICAgLy8gRmlyZUZveDogWm9uZS5wcm90b3R5cGUucnVuQGh0dHA6Ly9sb2NhbGhvc3Q6OTg3Ni9iYXNlL2J1aWxkL2xpYi96b25lLmpzOjEwMToyNFxuICAgICAgICAgICAgLy8gU2FmYXJpOiBydW5AaHR0cDovL2xvY2FsaG9zdDo5ODc2L2Jhc2UvYnVpbGQvbGliL3pvbmUuanM6MTAxOjI0XG4gICAgICAgICAgICBsZXQgZm5OYW1lOiBzdHJpbmcgPSBmcmFtZS5zcGxpdCgnKCcpWzBdLnNwbGl0KCdAJylbMF07XG4gICAgICAgICAgICBsZXQgZnJhbWVUeXBlID0gRnJhbWVUeXBlLnRyYW5zaXRpb247XG4gICAgICAgICAgICBpZiAoZm5OYW1lLmluZGV4T2YoJ1pvbmVBd2FyZUVycm9yJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgIGlmIChmbk5hbWUuaW5kZXhPZignbmV3IFpvbmVBd2FyZUVycm9yJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgem9uZUF3YXJlRnJhbWUxID0gZnJhbWU7XG4gICAgICAgICAgICAgICAgem9uZUF3YXJlRnJhbWUyID0gZnJhbWUucmVwbGFjZSgnbmV3IFpvbmVBd2FyZUVycm9yJywgJ25ldyBFcnJvci5ab25lQXdhcmVFcnJvcicpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHpvbmVBd2FyZUZyYW1lMVdpdGhvdXROZXcgPSBmcmFtZTtcbiAgICAgICAgICAgICAgICB6b25lQXdhcmVGcmFtZTJXaXRob3V0TmV3ID0gZnJhbWUucmVwbGFjZSgnRXJyb3IuJywgJycpO1xuICAgICAgICAgICAgICAgIGlmIChmcmFtZS5pbmRleE9mKCdFcnJvci5ab25lQXdhcmVFcnJvcicpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgem9uZUF3YXJlRnJhbWUzV2l0aG91dE5ldyA9XG4gICAgICAgICAgICAgICAgICAgICAgZnJhbWUucmVwbGFjZSgnWm9uZUF3YXJlRXJyb3InLCAnRXJyb3IuWm9uZUF3YXJlRXJyb3InKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgYmxhY2tMaXN0ZWRTdGFja0ZyYW1lc1t6b25lQXdhcmVGcmFtZTJdID0gRnJhbWVUeXBlLmJsYWNrTGlzdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmbk5hbWUuaW5kZXhPZigncnVuR3VhcmRlZCcpICE9PSAtMSkge1xuICAgICAgICAgICAgICBydW5HdWFyZGVkRnJhbWUgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmbk5hbWUuaW5kZXhPZigncnVuVGFzaycpICE9PSAtMSkge1xuICAgICAgICAgICAgICBydW5UYXNrRnJhbWUgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmbk5hbWUuaW5kZXhPZigncnVuJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgIHJ1bkZyYW1lID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGZyYW1lVHlwZSA9IEZyYW1lVHlwZS5ibGFja0xpc3Q7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBibGFja0xpc3RlZFN0YWNrRnJhbWVzW2ZyYW1lXSA9IGZyYW1lVHlwZTtcbiAgICAgICAgICAgIC8vIE9uY2Ugd2UgZmluZCBhbGwgb2YgdGhlIGZyYW1lcyB3ZSBjYW4gc3RvcCBsb29raW5nLlxuICAgICAgICAgICAgaWYgKHJ1bkZyYW1lICYmIHJ1bkd1YXJkZWRGcmFtZSAmJiBydW5UYXNrRnJhbWUpIHtcbiAgICAgICAgICAgICAgKFpvbmVBd2FyZUVycm9yIGFzIGFueSlbc3RhY2tSZXdyaXRlXSA9IHRydWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSkgYXMgWm9uZTtcbiAgLy8gY2FyZWZ1bGx5IGNvbnN0cnVjdG9yIGEgc3RhY2sgZnJhbWUgd2hpY2ggY29udGFpbnMgYWxsIG9mIHRoZSBmcmFtZXMgb2YgaW50ZXJlc3Qgd2hpY2hcbiAgLy8gbmVlZCB0byBiZSBkZXRlY3RlZCBhbmQgYmxhY2tsaXN0ZWQuXG5cbiAgY29uc3QgY2hpbGREZXRlY3Rab25lID0gZGV0ZWN0Wm9uZS5mb3JrKHtcbiAgICBuYW1lOiAnY2hpbGQnLFxuICAgIG9uU2NoZWR1bGVUYXNrOiBmdW5jdGlvbihkZWxlZ2F0ZSwgY3VyciwgdGFyZ2V0LCB0YXNrKSB7XG4gICAgICByZXR1cm4gZGVsZWdhdGUuc2NoZWR1bGVUYXNrKHRhcmdldCwgdGFzayk7XG4gICAgfSxcbiAgICBvbkludm9rZVRhc2s6IGZ1bmN0aW9uKGRlbGVnYXRlLCBjdXJyLCB0YXJnZXQsIHRhc2ssIGFwcGx5VGhpcywgYXBwbHlBcmdzKSB7XG4gICAgICByZXR1cm4gZGVsZWdhdGUuaW52b2tlVGFzayh0YXJnZXQsIHRhc2ssIGFwcGx5VGhpcywgYXBwbHlBcmdzKTtcbiAgICB9LFxuICAgIG9uQ2FuY2VsVGFzazogZnVuY3Rpb24oZGVsZWdhdGUsIGN1cnIsIHRhcmdldCwgdGFzaykge1xuICAgICAgcmV0dXJuIGRlbGVnYXRlLmNhbmNlbFRhc2sodGFyZ2V0LCB0YXNrKTtcbiAgICB9LFxuICAgIG9uSW52b2tlOiBmdW5jdGlvbihkZWxlZ2F0ZSwgY3VyciwgdGFyZ2V0LCBjYWxsYmFjaywgYXBwbHlUaGlzLCBhcHBseUFyZ3MsIHNvdXJjZSkge1xuICAgICAgcmV0dXJuIGRlbGVnYXRlLmludm9rZSh0YXJnZXQsIGNhbGxiYWNrLCBhcHBseVRoaXMsIGFwcGx5QXJncywgc291cmNlKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIHdlIG5lZWQgdG8gZGV0ZWN0IGFsbCB6b25lIHJlbGF0ZWQgZnJhbWVzLCBpdCB3aWxsXG4gIC8vIGV4Y2VlZCBkZWZhdWx0IHN0YWNrVHJhY2VMaW1pdCwgc28gd2Ugc2V0IGl0IHRvXG4gIC8vIGxhcmdlciBudW1iZXIgaGVyZSwgYW5kIHJlc3RvcmUgaXQgYWZ0ZXIgZGV0ZWN0IGZpbmlzaC5cbiAgY29uc3Qgb3JpZ2luYWxTdGFja1RyYWNlTGltaXQgPSBFcnJvci5zdGFja1RyYWNlTGltaXQ7XG4gIEVycm9yLnN0YWNrVHJhY2VMaW1pdCA9IDEwMDtcbiAgLy8gd2Ugc2NoZWR1bGUgZXZlbnQvbWljcm8vbWFjcm8gdGFzaywgYW5kIGludm9rZSB0aGVtXG4gIC8vIHdoZW4gb25TY2hlZHVsZSwgc28gd2UgY2FuIGdldCBhbGwgc3RhY2sgdHJhY2VzIGZvclxuICAvLyBhbGwga2luZHMgb2YgdGFza3Mgd2l0aCBvbmUgZXJyb3IgdGhyb3duLlxuICBjaGlsZERldGVjdFpvbmUucnVuKCgpID0+IHtcbiAgICBjaGlsZERldGVjdFpvbmUucnVuR3VhcmRlZCgoKSA9PiB7XG4gICAgICBjb25zdCBmYWtlVHJhbnNpdGlvblRvID0gKCkgPT4ge307XG4gICAgICBjaGlsZERldGVjdFpvbmUuc2NoZWR1bGVFdmVudFRhc2soXG4gICAgICAgICAgYmxhY2tsaXN0ZWRTdGFja0ZyYW1lc1N5bWJvbCxcbiAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICBjaGlsZERldGVjdFpvbmUuc2NoZWR1bGVNYWNyb1Rhc2soXG4gICAgICAgICAgICAgICAgYmxhY2tsaXN0ZWRTdGFja0ZyYW1lc1N5bWJvbCxcbiAgICAgICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjaGlsZERldGVjdFpvbmUuc2NoZWR1bGVNaWNyb1Rhc2soXG4gICAgICAgICAgICAgICAgICAgICAgYmxhY2tsaXN0ZWRTdGFja0ZyYW1lc1N5bWJvbCwgKCkgPT4geyB0aHJvdyBuZXcgRXJyb3IoKTsgfSwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICh0OiBUYXNrKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAodCBhcyBhbnkpLl90cmFuc2l0aW9uVG8gPSBmYWtlVHJhbnNpdGlvblRvO1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5pbnZva2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIGNoaWxkRGV0ZWN0Wm9uZS5zY2hlZHVsZU1pY3JvVGFzayhcbiAgICAgICAgICAgICAgICAgICAgICBibGFja2xpc3RlZFN0YWNrRnJhbWVzU3ltYm9sLCAoKSA9PiB7IHRocm93IEVycm9yKCk7IH0sIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICAodDogVGFzaykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgKHQgYXMgYW55KS5fdHJhbnNpdGlvblRvID0gZmFrZVRyYW5zaXRpb25UbztcbiAgICAgICAgICAgICAgICAgICAgICAgIHQuaW52b2tlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgKHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICh0IGFzIGFueSkuX3RyYW5zaXRpb25UbyA9IGZha2VUcmFuc2l0aW9uVG87XG4gICAgICAgICAgICAgICAgICB0Lmludm9rZSgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKCkgPT4ge30pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICh0KSA9PiB7XG4gICAgICAgICAgICAodCBhcyBhbnkpLl90cmFuc2l0aW9uVG8gPSBmYWtlVHJhbnNpdGlvblRvO1xuICAgICAgICAgICAgdC5pbnZva2UoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgICgpID0+IHt9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgRXJyb3Iuc3RhY2tUcmFjZUxpbWl0ID0gb3JpZ2luYWxTdGFja1RyYWNlTGltaXQ7XG59KTtcbiJdfQ==